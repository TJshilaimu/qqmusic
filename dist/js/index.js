"use strict";!function(i,e){function t(t){this.dom=t,this.dataList=[],this.nowIndex=0,this.timer=null,this.rotate=0,this.idx=null,this.show=!0,this.list=null,this.pro=e.pro.pros(),this.dur=0}t.prototype={init:function(){this.getDom(),this.getData("../mock/data.json")},getDom:function(){this.record=document.querySelector(".imgInfo img"),this.controlList=document.querySelectorAll("ul li")},getData:function(t){var o=this;i.ajax({url:t,method:"get",success:function(t){o.dataList=t,o.idx=new e.autoIndex(t.length),o.nowIndex=o.idx.now,o.listPlay(),o.getAudio(o.idx.now),o.playControl(),o.process()}})},getAudio:function(t){var o=this;this.dur=this.dataList[t].duration,e.render(o.dataList[t]),e.audioControl.load(o.dataList[t].audioSrc),this.pro.renderAllTime(o.dataList[t].duration),"pause"==e.audioControl.status?e.audioControl.pause():(e.audioControl.play(),o.controlList[2].className="play")},playControl:function(){var o=this;this.controlList[0].addEventListener("touchend",function(){o.dataList[0].isLike?(this.className="",o.dataList[0].isLike=!1):(this.className="liking",o.dataList[0].isLike=!0)}),this.controlList[1].addEventListener("touchend",function(){var t=o.idx.prev();o.nowIndex=o.idx.now,o.list.changeSelect(t),o.getAudio(t),e.audioControl.play(),o.controlList[2].className="play",o.imgRotate(0),o.pro.start(0)}),this.controlList[3].addEventListener("touchend",function(){var t=o.idx.next();o.nowIndex=o.idx.now,o.list.changeSelect(t),o.getAudio(t),e.audioControl.play(),o.controlList[2].className="play",o.imgRotate(0),o.pro.start(0)}),this.controlList[2].addEventListener("touchend",function(){var t;"pause"==e.audioControl.status?(e.audioControl.play(),o.controlList[2].className="play",t=o.record.dataset.rotate||0,o.imgRotate(t),o.pro.start()):(e.audioControl.pause(),o.controlList[2].className="",clearInterval(o.timer),o.pro.stop())}),this.controlList[4].addEventListener("touchend",function(){o.list.slideOut()})},imgRotate:function(t){var o=this;clearInterval(this.timer),this.timer=setInterval(function(){t=+t+.3,o.record.style.transform="rotate("+t+"deg)",o.record.dataset.rotate=t},1e3/60)},listPlay:function(){var i=this;this.list=e.createDom(i.dataList,i.dom),this.list.musicList.forEach(function(t,o){t.addEventListener("touchend",function(){i.nowIndex!=o&&(i.list.changeSelect(o),i.list.slideIn(),i.nowIndex=o,i.controlList[2].className="play",e.render(i.dataList[o]),e.audioControl.load(i.dataList[o].audioSrc),e.audioControl.play())})})},process:function(){var a=this,t=e.pro.drag(document.querySelector(".press .dot"));t.start=function(){e.audioControl.pause(),a.pro.stop()},t.move=function(t){a.pro.update(t,!0)},t.end=function(t){var o=t*a.dur;e.audioControl.playTo(o),e.audioControl.play(),a.pro.start(t,!1);var i=a.record.dataset.rotate||0;a.imgRotate(i),a.controlList[2].className="play"}}},new t(document.querySelector(".wrap")).init()}(window.Zepto,window.player);